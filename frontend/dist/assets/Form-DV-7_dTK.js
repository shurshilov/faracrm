import{n as i,j as r,V as F,P as C,W as y,X as j,Y as v,Z as h,_ as w,L as P}from"./index-vK4T-B9h.js";import{u as f,T as x}from"./use-form-1MgghPQc.js";import{A as V}from"./Actions-DltArpq0.js";import{B as g}from"./Button-kQItaDUP.js";function k(){const e=i.createContext(null);function s({form:t,children:a}){return r.jsx(e.Provider,{value:t,children:a})}function n(){const t=i.useContext(e);if(!t)throw new Error("useFormContext was called outside of FormProvider context");return t}return[s,n,f]}const[E,m]=k(),z=({name:e,...s})=>{const n=m();return i.createElement(x,{...s,...n.getInputProps(e),key:n.key(e),label:e})},R=({name:e,...s})=>{const n=m();return i.createElement(x,{...s,...n.getInputProps(e),key:n.key(e),label:e})};function I({model:e,id:s,fields:n}){const t=m(),[a,{isLoading:l}]=F();return r.jsx(g,{loading:l,variant:"filled",onClick:async()=>{const o=structuredClone(t.getValues());o.id&&delete o.id,n.forEach(u=>{u.type=="FieldMany2one"&&(o[u.name]=o[u.name].id)}),await a({model:e,id:s,values:o}),t.setInitialValues(t.getValues()),t.setValues(t.getValues()),t.reset()},children:"Save"})}function b({model:e}){const s=m(),n=C(),[t,{isLoading:a}]=y();return r.jsx(g,{loading:a,variant:"filled",onClick:async()=>{const l=s.getValues();await t({model:e,values:l}),n(`/${e}`)},children:"Create"})}const A=({model:e,children:s})=>{const{pathname:n}=j(),{id:t}=v(),a=i.useMemo(()=>i.Children.map(s,c=>i.isValidElement(c)?{name:c.props.name,type:c.type.name}:{})||[],[s]);console.log(a);const l={model:e,id:t,fields:a.map(c=>c.name)},o=t===void 0||n.includes("/create"),{data:u}=h({...l},{skip:o}),{data:p}=w({...l},{skip:!o}),d=f({mode:"uncontrolled",enhanceGetInputProps:c=>c.form.initialized?{}:{disabled:!0}});return i.useEffect(()=>{u?d.initialize(u):p&&d.initialize(p)},[u,p]),r.jsx(r.Fragment,{children:r.jsxs(E,{form:d,children:[r.jsxs(P,{mih:50,gap:"xs",justify:"space-between",align:"center",direction:"row",wrap:"nowrap",children:[r.jsxs(r.Fragment,{children:[d.isDirty()&&!!t&&r.jsx(I,{model:e,id:t,fields:a}),d.isDirty()&&o&&r.jsx(b,{model:e})]}),!!t&&r.jsx(V,{resource:e,selectedIds:[t]})]}),r.jsx("form",{children:s})]})})};export{A as F,R as a,z as b,m as u};
